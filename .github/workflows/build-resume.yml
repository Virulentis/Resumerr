name: Build Resume Variants

on:
  push:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      variants:
        description: Comma-separated resume variants to build
        required: false
        default: full
      release_tag:
        description: Release tag (leave blank to auto-generate)
        required: false
        default: ''
      release_name:
        description: Release title (optional)
        required: false
        default: ''
      release_body:
        description: Release notes (optional)
        required: false
        default: ''

jobs:
  render:
    permissions:
      contents: write
    uses: ahzs645/resume/.github/workflows/render-from-caller.yml@main  # Pin to a tag/SHA in production
    with:
      yaml_path: CV.yaml
      variants: ${{ inputs.variants != '' && inputs.variants || 'full' }}
      python_version: '3.13'
      upload_artifacts: 'true'
      publish_release: 'true'
      release_overwrite: ${{ github.event_name == 'workflow_dispatch' && 'false' || 'true' }}
      release_tag: ${{ github.event_name == 'workflow_dispatch' && (inputs.release_tag != '' && inputs.release_tag || format('resume-{0}', github.run_id)) || 'resume-latest' }}
      release_name: "${{ github.event_name == 'workflow_dispatch' && (inputs.release_name != '' && inputs.release_name || format('Resume build #{0}', github.run_number)) || 'Latest Resume' }}"
      release_body: ${{ github.event_name == 'workflow_dispatch' && (inputs.release_body != '' && inputs.release_body || 'Manual resume build.') || format('Automated build from {0} ({1}).', github.ref_name, github.sha) }}
